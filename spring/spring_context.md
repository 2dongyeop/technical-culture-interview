## 영속성 컨텍스트란 무엇인가?

<br/>

> 영속성 컨텍스트 개념
>
- 영속성 컨텍스트(Persistence Context)는 **JPA에서 엔티티 객체를 관리하는 메모리상의 저장소**입니다.
- 쉽게 말해, **JPA의 EntityManager가 관리하는 1차 캐시 역할을 하는 공간**으로, **트랜잭션이 진행되는 동안 엔티티를 추적하고 관리**합니다.

<br/>

> 영속성 컨텍스트의 주요 특징
>
1. 엔티티 생명 주기관리
    - 비영속 : 엔티티가 아직 영속성 컨텍스트에 저장되지 않음
    - 영속 : 영속성 컨텍스트에 저장됨(1차 캐시에 존재)
    - 준영속 : 영속성 컨텍스트에서 분리됨(더 이상 관리되지 않음)
    - 삭제 : 엔티티가 삭제됨 (DB에서도 삭제 예정)

1. **1차 캐시 (First-Level Cache)**
    - **영속성 컨텍스트는 1차 캐시 역할을 수행하여 성능을 최적화**합니다.
    - 동일한 트랜잭션 내에서 동일한 엔티티를 다시 조회할 경우 **DB를 조회하지 않고 메모리에서 가져옴**.

1. **변경 감지 (Dirty Checking)**
    - 영속 상태의 엔티티가 변경되면 **자동으로 업데이트(UPDATE SQL 실행)**
    - `flush()` 또는 **트랜잭션이 커밋될 때 변경 사항을 감지하여 DB에 반영**

4. **지연 로딩 (Lazy Loading)**

    - `@OneToMany`, `@ManyToOne` 등 관계를 맺고 있는 엔티티를 필요할 때 로딩하는 방식
    - 기본적으로 `LAZY` 전략이 적용되어 있어 **필요한 순간까지 쿼리를 실행하지 않음**
    - 성능 최적화에 유용하지만, 영속성 컨텍스트가 닫힌 상태에서 조회하면 **LazyInitializationException 발생**

<br/>

> 영속성 컨텍스트의 동작 방식
>
1. **`persist()` 호출 → 엔티티를 1차 캐시에 저장 (DB에 즉시 반영되지 않음)**
2. **트랜잭션 커밋 시 `flush()` → 변경된 엔티티들을 DB에 반영**
3. **트랜잭션이 종료되면 영속성 컨텍스트가 종료됨 (1차 캐시 사라짐)**