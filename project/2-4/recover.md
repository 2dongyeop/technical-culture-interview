## 서비스 복구/백업 프로세스 설립시 고려사항

> **복구 목표 설정 (RTO & RPO)**
>

- **RTO (Recovery Time Objective)**
    - **서비스가 중단된 후 복구까지 허용 가능한 최대 시간**
    - 예: RTO가 10분이라면, 장애 발생 후 10분 내 복구해야 함.
- **RPO (Recovery Point Objective)**
    - **데이터 손실을 허용할 수 있는 최대 시간**
    - 예: RPO가 1시간이면, 최근 1시간 내의 데이터까지만 복구 가능함.
- **비즈니스 요구 사항에 따라 다름**
    - 금융 서비스: RTO 1~5분, RPO 0초 (실시간 이중화 필수)
    - 일반 웹 서비스: ~~RTO 12시간, RPO 1030분~~

<br/>

> 백업 전략 설계
>

- 서비스의 중요도에 따라 적절한 백업 방식 선택이 필요
- **백업 유형**

  | 백업 방식 | 설명 | 장점 | 단점 |
      | --- | --- | --- | --- |
  | 전체 백업 (Full Backup) | 모든 데이터를 백업 | 복구가 빠름 | 백업 용량이 큼, 느림 |
  | 증분 백업 (Incremental Backup) | 마지막 백업 이후 변경된 데이터만 백업 | 저장 공간 절약, 빠름 | 복구 과정이 복잡 |
  | 차등 백업 (Differential Backup) | 전체 백업 이후 변경된 모든 데이터 백업 | 복구가 간단 | 백업 시간이 증가 |
  | 스냅샷 (Snapshot) | 특정 시점의 상태를 저장 (DB, VM 등) | 빠른 복구 가능 | 저장 비용 발생 가능 |

- AWS 환경에서의 백업 전략 예시
    - **EC2 인스턴스**: EBS 스냅샷 + AMI 백업 (주기적)
    - **RDS (MySQL, PostgreSQL 등)**: 자동 백업 + PITR(Point-in-Time Recovery) 설정
    - **S3 데이터**: 버전 관리 + Cross-Region Replication 적용

<br/>

> **장애 감지 프로세스**
>

- 모니터링 시스템 구축
    - Prometheus + Grafana → 서버 및 애플리케이션 성능 모니터링
    - AWS CloudWatch / Datadog → 인프라 모니터링
    - n8n / PagerDuty → 장애 감지 후 알림 전송 (Slack, SMS, Email) 및 대응 자동화
- 예시: 주요 모니터링 메트릭
    - API 응답 시간 (Latency)
    - DB 쿼리 응답 속도
    - CPU, 메모리 사용량
    - HTTP 5xx 에러 비율

<br/>

> 자동 복구 프로세스
>

- **예시**
    1. n8n 헬스체크 경보 발생
    2. 신규 EC2 등록 쉘 스크립트를 트리거
    3. ELB에 새로운 인스턴스를 등록 후 트래픽 라우팅