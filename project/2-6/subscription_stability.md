## 구독/결제 시스템에서 안정성 확보 및 상태 관리 전략을 어떻게 구성했나요?

> 안정성 확보
>

1. **외부 결제 시스템(Google Play, App Store)과의 연동**
    - 구독 결제 결과를 각 스토어 API로 검증하여 반영
    - 스토어측에서 구독 상태 반영에 지연이 있을 수 있으므로, Backoff 방식으로 지연시간을 두고 **Retry 메커니즘** 적용

1. **상태 검증**
    - 클라이언트에서도 스토어 API를 호출해 검증할 수 있지만, **서버에서 직접 검증함으로써 신뢰성 증가**

1. **장애 대응**
    - DB 트랜잭션 관리: **결제 내역 저장 → 상태 업데이트 → 혜택 적용 순서 보장**
    - 모니터링 대시보드 (Prometheus + Grafana) 구축으로 실시간 장애 감지
    - Retry 이후 최종 검증 실패시에는 Alert 동작 후, 수동 검증 진행

<br/>

> 구독 상태 관리 전략
>

1. **공통 구독 상태 모델 정의**
    - Google Play / App Store의 상태 모델이 다름 → **통합 상태 모델 설계**
    - 각 스토어의 결제 상태를 매핑하여 **일관된 내부 상태(Active, Expired 등) 유지**

1. **구독 상태 동기화**

- 주기적으로 구독 상태를 검증하도록 스케줄러를 구성
- 아래와 같은 이유로, 스토어 측에서 제공하는 구독상태변경 이벤트 푸시 시스템을 사용하지 않음
    1. 이벤트 푸시 발생시, 네트워크 오류로 인해 푸시가 전달되지 않았을 때에 대한 Retry 처리를 스토어측이 구현했는지 확신할 수 없음.
    2. 이벤트 푸시 발생시, 스토어측 서버 에러(500)로 인해 푸시가 정상 동작하지 않을지도 모름
    3. 인프라/네트워크 설정으로 인해 요청이 당사 측 서버로 전달되지 않을 경우, 이를 알 수 없음